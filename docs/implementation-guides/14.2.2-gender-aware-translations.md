# Phase 2.2: Gender-Aware Translations — Complete Implementation Guide

**Last updated:** 2025-10-24  
**Phase:** 2.2 (Advanced i18n Features)  
**Status:** ✅ COMPLETED

---

## 1. Overview

Gender-aware translations allow the translation system to vary text based on the gender of the subject. This is especially important for languages like Arabic and Hindi where grammatical gender affects adjectives, verbs, and titles.

**Example:**
```
EN: "Welcome, {{name}}!"
AR: "أهلا بك يا السيد {{name}}!" (male)
AR: "أهلا بك يا السيدة {{name}}!" (female)
```

### Key Features

- ✅ Support for gender-specific translations in Arabic (masculine/feminine)
- ✅ Support for gender-specific translations in Hindi (masculine/feminine/neuter)
- ✅ English gracefully ignores gender (single form for all)
- ✅ Automatic fallback to base form if gender variant unavailable
- ✅ Type-safe gender parameter support
- ✅ Context-aware default gender per locale
- ✅ Session-level gender preference support

### Supported Genders per Locale

| Locale | Gender Types | Default | Use Case |
|--------|--------------|---------|----------|
| **en** (English) | None | N/A | No grammatical gender; single form used |
| **ar** (Arabic) | `male`, `female` | `male` | Titles, adjectives, verb conjugation |
| **hi** (Hindi) | `male`, `female`, `neuter` | `male` | Adjectives, verb agreement, titles |

---

## 2. Architecture

### 2.1 Core Components

#### `src/lib/gender-rules.ts`
Utility library defining gender forms, validation, and key building.

**Key exports:**
```typescript
export type GenderType = 'male' | 'female' | 'neuter'
export const genderVariants: Record<Locale, GenderType[]>
export const genderFormMap: Record<GenderType, string>
export const defaultGenderForLocale: Record<Locale, GenderType | null>

export function supportsGender(locale: Locale): boolean
export function getGenderFormsForLocale(locale: Locale): GenderType[]
export function isValidGenderForLocale(gender: GenderType | undefined, locale: Locale): boolean
export function buildGenderKey(baseKey: string, gender: GenderType | undefined, locale: Locale): string
export function buildGenderKeyFallbacks(baseKey: string, gender: GenderType | undefined, locale: Locale): string[]
export function getDefaultGenderForLocale(locale: Locale): GenderType | undefined
```

#### `src/types/gender-translation.ts`
TypeScript type definitions for gender-aware translation system.

**Key types:**
```typescript
export interface TranslationParams {
  [key: string]: string | number | boolean | undefined
  gender?: GenderType
  count?: number
}

export type TranslationFunction = (key: string, params?: TranslationParams) => string

export interface UseTranslationsReturn {
  t: TranslationFunction
  locale: string
  setLocale: (locale: string) => void
  dir: 'ltr' | 'rtl'
  currentGender?: GenderType
  setGender?: (gender: GenderType | undefined) => void
}
```

#### `src/lib/i18n.ts` (Updated)
Enhanced translation context and hook with gender support.

**Key changes:**
- `TranslationContext` now includes `currentGender` and `setGender`
- `useTranslations()` hook returns `currentGender` and `setGender`
- Translation function `t()` accepts gender in params
- Automatic fallback chain: gender-specific key → base key

#### `src/components/providers/translation-provider.tsx` (Updated)
Provider now manages gender state alongside locale.

**New features:**
```typescript
<TranslationProvider
  initialLocale="en"
  initialGender="male"  // Optional: set default gender for session
>
  {children}
</TranslationProvider>
```

### 2.2 Key Resolution Process

When `t(key, params)` is called:

1. **Extract gender** from `params.gender` OR use `context.currentGender`
2. **Build fallback chain** using `buildGenderKeyFallbacks()`
   - For `ar` + `female`: `["greeting.welcome.female", "greeting.welcome"]`
   - For `en` + `male`: `["greeting.welcome"]` (gender ignored)
   - For `hi` + `neuter`: `["greeting.welcome.neuter", "greeting.welcome"]`
3. **Find translation** by checking each fallback key in order
4. **Substitute parameters** (excluding `gender` and `count`)
5. **Return** translated string or key if not found

---

## 3. Usage Guide

### 3.1 Basic Usage in Components

#### Without Explicit Gender

Use context default gender:

```typescript
'use client'

import { useTranslations } from '@/lib/i18n'

export function Welcome({ name }: { name: string }) {
  const { t } = useTranslations()

  return (
    <h1>{t('greeting.welcome', { name })}</h1>
  )
}

// If context gender is 'male': "Welcome, Mr. John!"
// If context gender is 'female': "Welcome, Ms. Jane!"
// If context gender is undefined: "Welcome, John!"
```

#### With Explicit Gender Parameter

Override context gender for this translation:

```typescript
export function ConsultantCard({ name, gender }: { name: string; gender: 'male' | 'female' }) {
  const { t } = useTranslations()

  return (
    <div>
      <h2>{t('greeting.welcome', { name, gender })}</h2>
      <p>{t('greeting.consultant', { gender })}</p>
    </div>
  )
}
```

#### Setting Session Gender

Change default gender for entire session:

```typescript
export function GenderPreferences() {
  const { currentGender, setGender } = useTranslations()

  return (
    <div>
      <label>
        <input
          type="radio"
          name="gender"
          value="male"
          checked={currentGender === 'male'}
          onChange={(e) => setGender(e.target.value as 'male' | 'female' | 'neuter')}
        />
        Masculine
      </label>
      <label>
        <input
          type="radio"
          name="gender"
          value="female"
          checked={currentGender === 'female'}
          onChange={(e) => setGender(e.target.value as 'male' | 'female' | 'neuter')}
        />
        Feminine
      </label>
      <label>
        <input
          type="radio"
          name="gender"
          value={undefined}
          checked={currentGender === undefined}
          onChange={() => setGender(undefined)}
        />
        Neutral
      </label>
    </div>
  )
}
```

#### With Multiple Parameters

Combine gender with other substitutions:

```typescript
export function NotificationBanner({
  assignee,
  assigneeGender,
  dueDate
}: {
  assignee: string
  assigneeGender: 'male' | 'female'
  dueDate: string
}) {
  const { t } = useTranslations()

  return (
    <div>
      {t('notification.assigned', {
        assignee,
        gender: assigneeGender,
        dueDate
      })}
    </div>
  )
}

// With translation:
// "notification.assigned.male": "{{assignee}} has been assigned (he will start soon)"
// "notification.assigned.female": "{{assignee}} has been assigned (she will start soon)"
```

### 3.2 Adding Gender Variants to Translations

#### English (no gender variants needed)

```json
{
  "greeting.welcome": "Welcome, {{name}}!",
  "profile.role": "Consultant"
}
```

English ignores gender parameter — use same translation for all.

#### Arabic (masculine/feminine)

```json
{
  "greeting.welcome": "أهلا وسهلا {{name}}!",
  "greeting.welcome.male": "أهلا بك يا السيد {{name}}!",
  "greeting.welcome.female": "أهلا بك يا السيدة {{name}}!",

  "profile.accountType": "نوع الحساب",
  "profile.accountType.male": "أنت مسجل كاستشاري ذكر",
  "profile.accountType.female": "أنت مسجلة كاستشارية أنثى",

  "notification.assigned": "تم تعيين مهمة لك",
  "notification.assigned.male": "تم تعيين مهمة ل {{assignee}}، وسيبدأ قريباً",
  "notification.assigned.female": "تم تعيين مهمة ل {{assignee}}، وستبدأ قريباً"
}
```

#### Hindi (masculine/feminine/neuter)

```json
{
  "greeting.welcome": "स्वागत है, {{name}}!",
  "greeting.welcome.male": "स्वागत है, श्री {{name}}!",
  "greeting.welcome.female": "स्वागत है, श्रीमती {{name}}!",
  "greeting.welcome.neuter": "स्वागत है, {{name}}!",

  "profile.accountType": "खाता प्रकार",
  "profile.accountType.male": "आप एक पुरुष सलाहकार के रूप में पंजीकृत हैं",
  "profile.accountType.female": "आप एक महिला सलाहकार के रूप में पंजीकृत हैं",
  "profile.accountType.neuter": "आप एक सलाहकार के रूप में पंजीकृत हैं",

  "notification.assigned": "आपको एक कार्य सौंपा गया है",
  "notification.assigned.male": "{{assignee}} को एक कार्य सौंपा गया है, वह जल्द ही शुरू करेंगे",
  "notification.assigned.female": "{{assignee}} को एक कार्य सौंपा गया है, वह जल्द ही शुरू करेंगी"
}
```

### 3.3 Best Practices

#### ✅ DO: Provide fallback base key

Always include the non-gendered base form:

```json
{
  "greeting.welcome": "Welcome, {{name}}!",
  "greeting.welcome.male": "Welcome, Mr. {{name}}!",
  "greeting.welcome.female": "Welcome, Ms. {{name}}!"
}
```

#### ✅ DO: Keep gender variants structurally consistent

All variants of the same key should serve the same purpose:

```json
{
  "profile.role": "Your role",
  "profile.role.male": "You are registered as a male {{role}}",
  "profile.role.female": "You are registered as a female {{role}}"
}
```

#### ✅ DO: Use gender for grammatically necessary cases

Arabic and Hindi require gender for proper grammar:

```json
{
  "greeting.consultant.male": "استشارك (ذكر)",
  "greeting.consultant.female": "استشارتك (أنثى)"
}
```

#### ❌ DON'T: Add gender variants unnecessarily

Don't over-use gender for English:

```json
// ❌ AVOID
{
  "hello": "Hello!",
  "hello.male": "Hello, man!",
  "hello.female": "Hello, woman!"
}

// ✅ PREFER
{
  "hello": "Hello!"
}
```

#### ❌ DON'T: Use gender for personality/preference

Gender forms are for linguistic agreement, not for stereotyping:

```json
// ❌ AVOID
{
  "hobby.male": "He likes sports",
  "hobby.female": "She likes shopping"
}

// ✅ PREFER
{
  "hobby": "Tell us about your hobbies"
}
```

---

## 4. Locale-Specific Patterns

### 4.1 Arabic (العربية)

**Grammar:** Masculine/feminine agreement in adjectives, titles, verbs

**Common patterns:**

| Pattern | Masculine | Feminine | English |
|---------|-----------|----------|---------|
| Titles | السيد (Mr.) | السيدة (Ms.) | Mr./Ms. |
| Adjectives | مشغول (busy) | مشغولة (busy-f) | busy |
| Verbs | سيبدأ (will start) | ستبدأ (will start-f) | will start |

**Example translations:**

```json
{
  "title.mr": "السيد",
  "title.ms": "السيدة",

  "status.busy.male": "{{name}} مشغول حالياً",
  "status.busy.female": "{{name}} مشغولة حالياً",

  "action.starting.male": "{{name}} سيبدأ قريباً",
  "action.starting.female": "{{name}} ستبدأ قريباً"
}
```

### 4.2 Hindi (हिन्दी)

**Grammar:** Masculine/feminine/neuter agreement in adjectives and verbs

**Common patterns:**

| Pattern | Masculine | Feminine | Neuter | English |
|---------|-----------|----------|--------|---------|
| Titles | श्री (Mr.) | श्रीमती (Mrs.) | N/A | Mr./Mrs. |
| Adjectives | व्यस्त (busy-m) | व्यस्त (busy-f) | व्यस्त (busy-n) | busy |
| Verbs | करेंगे (will do-m) | करेंगी (will do-f) | करेगा (will do-n) | will do |

**Example translations:**

```json
{
  "title.mr": "श्री",
  "title.mrs": "श्रीमती",

  "status.ready.male": "{{name}} तैयार हैं",
  "status.ready.female": "{{name}} तैयार हैं",
  "status.ready.neuter": "{{name}} तैयार है",

  "action.joined.male": "{{name}} जुड़ गए",
  "action.joined.female": "{{name}} जुड़ गईं",
  "action.joined.neuter": "{{name}} जुड़ गया"
}
```

### 4.3 English (English)

**Grammar:** No grammatical gender; single form for all

**Approach:** Provide base form only, ignore gender parameter

```json
{
  "greeting.welcome": "Welcome, {{name}}!",
  "status.available": "Available",
  "action.joining": "Joining..."
}
```

---

## 5. API Reference

### Gender Rules (`src/lib/gender-rules.ts`)

#### `supportsGender(locale: Locale): boolean`
Check if locale supports gender-specific translations.

```typescript
supportsGender('en')  // false
supportsGender('ar')  // true
supportsGender('hi')  // true
```

#### `getGenderFormsForLocale(locale: Locale): GenderType[]`
Get all supported gender forms for a locale.

```typescript
getGenderFormsForLocale('en')  // []
getGenderFormsForLocale('ar')  // ['male', 'female']
getGenderFormsForLocale('hi')  // ['male', 'female', 'neuter']
```

#### `isValidGenderForLocale(gender: GenderType | undefined, locale: Locale): boolean`
Validate if gender is supported by locale.

```typescript
isValidGenderForLocale('male', 'ar')    // true
isValidGenderForLocale('neuter', 'ar')  // false
isValidGenderForLocale('neuter', 'hi')  // true
isValidGenderForLocale(undefined, 'ar') // true (always valid)
```

#### `buildGenderKey(baseKey: string, gender: GenderType | undefined, locale: Locale): string`
Build gender-specific translation key.

```typescript
buildGenderKey('greeting.welcome', 'male', 'ar')
// → 'greeting.welcome.male'

buildGenderKey('greeting.welcome', 'male', 'en')
// → 'greeting.welcome' (EN doesn't support gender)

buildGenderKey('greeting.welcome', undefined, 'ar')
// → 'greeting.welcome'
```

#### `buildGenderKeyFallbacks(baseKey: string, gender: GenderType | undefined, locale: Locale): string[]`
Build fallback chain for translation lookup.

```typescript
buildGenderKeyFallbacks('greeting.welcome', 'female', 'ar')
// → ['greeting.welcome.female', 'greeting.welcome']

buildGenderKeyFallbacks('greeting.welcome', undefined, 'ar')
// → ['greeting.welcome']

buildGenderKeyFallbacks('greeting.welcome', 'male', 'en')
// → ['greeting.welcome']
```

#### `getDefaultGenderForLocale(locale: Locale): GenderType | undefined`
Get default gender for locale (when not specified).

```typescript
getDefaultGenderForLocale('en')  // undefined
getDefaultGenderForLocale('ar')  // 'male'
getDefaultGenderForLocale('hi')  // 'male'
```

### Translation Hook (`src/lib/i18n.ts`)

#### `useTranslations(): UseTranslationsReturn`
Access translation function with gender support.

```typescript
const { t, locale, setLocale, dir, currentGender, setGender } = useTranslations()

// Use translation with gender
t('greeting.welcome', { name: 'Alice', gender: 'female' })

// Change default gender
setGender('female')

// Clear default gender
setGender(undefined)
```

### Translation Provider (`src/components/providers/translation-provider.tsx`)

#### `<TranslationProvider />`
Provider component with gender support.

```typescript
<TranslationProvider
  initialLocale="en"
  initialGender="male"  // Optional
>
  <App />
</TranslationProvider>
```

**Props:**
- `initialLocale?: Locale` - Default locale (default: 'en')
- `initialGender?: GenderType` - Default gender (optional)
- `children: ReactNode` - Child components

---

## 6. Testing

### Test Gender Rules

```typescript
import { buildGenderKeyFallbacks, isValidGenderForLocale } from '@/lib/gender-rules'

describe('Gender Rules', () => {
  it('should build fallback for Arabic female', () => {
    const fallbacks = buildGenderKeyFallbacks('greeting.welcome', 'female', 'ar')
    expect(fallbacks).toEqual(['greeting.welcome.female', 'greeting.welcome'])
  })

  it('should validate gender per locale', () => {
    expect(isValidGenderForLocale('male', 'ar')).toBe(true)
    expect(isValidGenderForLocale('neuter', 'ar')).toBe(false)
    expect(isValidGenderForLocale('neuter', 'hi')).toBe(true)
  })
})
```

### Test Component Integration

```typescript
import { renderHook } from '@testing-library/react'
import { useTranslations } from '@/lib/i18n'
import { TranslationProvider } from '@/components/providers/translation-provider'

describe('Gender-Aware Translations in Components', () => {
  it('should use gender from params', () => {
    const wrapper = ({ children }) => (
      <TranslationProvider initialLocale="en">{children}</TranslationProvider>
    )

    const { result } = renderHook(() => useTranslations(), { wrapper })
    const translation = result.current.t('greeting.welcome', {
      name: 'Alice',
      gender: 'female'
    })

    expect(translation).toContain('Alice')
  })

  it('should use context gender as default', () => {
    const wrapper = ({ children }) => (
      <TranslationProvider initialLocale="en" initialGender="female">
        {children}
      </TranslationProvider>
    )

    const { result } = renderHook(() => useTranslations(), { wrapper })
    expect(result.current.currentGender).toBe('female')
  })
})
```

---

## 7. Examples

### Example 1: User Profile with Gender

```typescript
export function UserProfile({ userId }: { userId: string }) {
  const [user, setUser] = useState<User | null>(null)
  const { t } = useTranslations()

  useEffect(() => {
    // Fetch user data...
    setUser({ name: 'Sarah', gender: 'female' })
  }, [userId])

  if (!user) return null

  return (
    <div>
      <h1>{t('greeting.welcome', { name: user.name, gender: user.gender })}</h1>
      <p>{t('profile.accountType', { gender: user.gender })}</p>
    </div>
  )
}
```

### Example 2: Assignment Notification

```typescript
export function AssignmentNotification({
  task,
  assignee,
  assigneeGender
}: {
  task: Task
  assignee: string
  assigneeGender: 'male' | 'female'
}) {
  const { t } = useTranslations()

  return (
    <Alert>
      {t('notification.assigned', {
        assignee,
        gender: assigneeGender,
        task: task.title
      })}
    </Alert>
  )
}

// With Arabic translations:
// "notification.assigned.male": "تم تعيين {{task}} ل {{assignee}}، وسيبدأ قريباً"
// "notification.assigned.female": "تم تعيين {{task}} ل {{assignee}}، وستبدأ قريباً"
```

### Example 3: Email Greeting

```typescript
export function EmailTemplate({ recipientName, recipientGender }: EmailProps) {
  const { t } = useTranslations()

  return (
    <email>
      <h1>{t('email.greeting', { name: recipientName, gender: recipientGender })}</h1>
      <p>Content here...</p>
    </email>
  )
}

// With translations:
// EN: "Hello {{name}}"
// AR: "مرحباً السيد {{name}}" or "مرحباً السيدة {{name}}"
// HI: "नमस्ते श्री {{name}}" or "नमस्ते श्रीमती {{name}}"
```

---

## 8. Migration from Phase 2.1 (Pluralization)

Phase 2.2 works seamlessly with Phase 2.1 (Pluralization). Both can be used together:

```typescript
// Phase 2.1 + 2.2 combined
t('items.count', {
  count: 5,
  gender: 'male'
})

// With translation:
// "items.count.male": "{{count}} items assigned to {{assignee}}"
```

---

## 9. Troubleshooting

### Q: Gender parameter is ignored in English?
**A:** By design. English doesn't support grammatical gender. Use a single form for all.

### Q: Missing female variant shows masculine instead?
**A:** Correct. The fallback chain uses masculine (default) when feminine variant is missing.

### Q: How to require gender for certain keys?
**A:** Best practice: always provide a base form for fallback. Components should explicitly pass gender when needed.

### Q: Can I have custom gender forms?
**A:** Phase 2.2 supports `male`/`female`/`neuter`. For custom forms, Phase 3+ will add advanced i18n patterns.

---

## 10. Files Modified/Created

### Created
- `src/lib/gender-rules.ts` — Gender utility functions
- `src/types/gender-translation.ts` — Type definitions
- `tests/lib/gender-translation.test.ts` — Unit tests
- `tests/lib/gender-translation-hook.test.ts` — Integration tests
- `docs/implementation-guides/14.2.2-gender-aware-translations.md` — This guide

### Modified
- `src/lib/i18n.ts` — Added gender support to hook
- `src/components/providers/translation-provider.tsx` — Added gender state management
- `src/app/locales/en.json` — Added gender variant examples
- `src/app/locales/ar.json` — Added Arabic gender variants
- `src/app/locales/hi.json` — Added Hindi gender variants

---

## 11. Phase 2.2 Summary

**Status:** ✅ COMPLETE

**What was implemented:**
- ✅ Gender rules utility with validation and key building
- ✅ Type-safe translation parameters with gender
- ✅ Hook integration with gender state management
- ✅ Translation provider with gender context
- ✅ Gender variants in all locale files
- ✅ Fallback chain for missing gender variants
- ✅ Comprehensive test coverage
- ✅ Complete documentation

**Ready for:**
- ✅ Production use
- ✅ Phase 2.3 (Namespace/grouping support)
- ✅ Phase 3 (Advanced features)

---

## 12. Next Steps (Phase 2.3)

Phase 2.3 will implement **Namespace/Grouping Support** to organize translations:

```json
{
  "nav": {
    "home": "Home",
    "about": "About"
  },
  "greeting": {
    "welcome": "Welcome!",
    "welcome.male": "Welcome, Sir!"
  }
}
```

This will improve translation file organization while maintaining backward compatibility.
